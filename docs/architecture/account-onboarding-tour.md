# アカウントページ新規ユーザーツアー設計

作成日: 2026-02-19
作成者: Codex（GPT-5）

## 背景

- `/account` は機能が増え、初見ユーザーが「どこから触ればよいか」を把握しづらい。
- 通常利用の邪魔を避けつつ、初回だけ重要導線を短時間で理解できるオンボーディングが必要。

## 目的

- 新規ログインユーザーが 7 ステップ以内で `/account` の主要機能を把握できる状態にする。
- ツアー終了後は自動再表示せず、必要時のみ手動で再表示できるようにする。

## 適用範囲

- 対象ページ: `/account`
- 対象ユーザー: 認証済みユーザー
- 非対象: 未ログインユーザーへの自動表示、DB 永続化、i18n 多言語化

## ツアー仕様

- 初回表示条件:
  - `status === authenticated`
  - `localStorage` に `account_page_tour_state_v1` が未保存
- 終了条件:
  - `完了` または `スキップ` を実行した時点で保存
  - 保存後は自動表示しない
- 手動再表示:
  - ページ見出し付近の `使い方ツアー` ボタンでいつでも再開可能
- ステップ構成:
  - アカウント基本情報
  - マイ予定設定
  - 予定一括管理の編集導線
  - 週ごとの用事タブ
  - 回答イベントへの反映確認
  - お気に入り / 回答履歴
  - 使い方ツアーの再確認

## 永続化仕様

- 保存先: `localStorage`
- キー: `account_page_tour_state_v1`
- 値:

```json
{
  "version": "v1",
  "status": "completed",
  "updatedAt": "2026-02-19T00:00:00.000Z"
}
```

- `status` は `completed | skipped`
- 破損データやバージョン不一致は未保存扱いにフォールバック

## UI / アクセシビリティ

- オーバーレイ + 強調枠 + 説明カードの構成。
- 説明カードは `role="dialog"` を付与し、現在ステップ数を表示。
- ステップ対象が存在しない場合は自動スキップして継続。
- 既存 `data-testid` とは分離し、ツアー対象識別には `data-tour-id` を使用。

## モバイル方針

- ステップ内容は PC と同一。
- 画面幅が狭い場合は説明カードを画面下部固定へ切り替える。
- 対象要素は `scrollIntoView` でスクロールしてから強調表示する。

## テスト方針

- ユニット:
  - `localStorage` 保存/復元、破損値、バージョン不一致
- コンポーネント:
  - 初回自動表示
  - 完了/スキップ後の自動抑止
  - 手動再表示
  - optional ステップのスキップ
- E2E:
  - 初回表示
  - スキップ後の再訪抑止
  - 手動再表示
  - モバイル幅での主要操作
